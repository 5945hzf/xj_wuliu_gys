<!--账户 编辑.提交审核-->
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-Control" CONTENT="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <meta name="format-detection" content="telephone=no" />
    <title>新疆化学品经营服务平台</title>
    <link rel="stylesheet" type="text/css" href="../css/commin.css"/>
    <link rel="stylesheet" type="text/css" href="../css/identification5.css"/>
    <style type="text/css">



    </style>
</head>
<body>
<div class="container">
    <div class="containerTitle">
        <div class="Lf">企业资质审核</div>
        <div class="Rt cfRefresh" style="width: 90px;height: 35px;border: 1px solid #f1f1f1;line-height: 35px;margin-top: 8px;"><img style="margin: 12px 5px 0 15px;" src="../img/cf_shuaxin.png" alt="">刷新</div>
    </div>
    <div class="header">
        <ul>
            <li>
                <a href="javascript:;">
                    <div class="Lf lan">1</div>
                    企业基本信息
                </a>
            </li>
            <li class="row">
                ..................
            </li>
            <li>
                <a href="javascript:;">
                    <div class="Lf lan">2</div>
                    运营者信息
                </a>
            </li>
            <li class="row">
                ..................
            </li>
            <li>
                <a href="javascript:;">
                    <div class="Lf lan">3</div>
                    发票信息
                </a>
            </li>
            <li class="row">
                ..................
            </li>
            <li>
                <a href="javascript:;">
                    <div class="Lf lan">4</div>
                    出金账户绑定
                </a>
            </li>
            <li class="row">
                ..................
            </li>
            <li>
                <a href="javascript:;">
                    <div class="Lf orange">5</div>
                    财务信息
                </a>
            </li>
        </ul>
    </div>

    <div class="bottom1" style="">
        <div class="right3  mei clearFloat" style="margin-top: 13px;margin-left: 140px;">
            <div class="Rt" style="font-size: 14px;margin-right: 20px;"><img style="width: 13px;height: 13px;margin-top: 3px; margin-right: 3px;" src="../img/wenhao.png" alt=""><a href="" style="color: #5590f6;">操作步骤帮助</a></div>
        </div>
        <div class="right2 Lf" style="margin-top:10px;width: 750px;">
            <ul>
                <li class="clearfix">
                    <div class="left1 Lf"><i class="red">*</i>财务姓名:</div>
                    <div class="right1 Lf"><input type="text" id="caiwu_name"></div>
                    <div class="ts Lf" style="margin-left: 5px;">财务姓名不能为空</div>
                </li>
                <li>
                    <div class="left1 Lf"><i class="red">*</i>身份证号:</div>
                    <div class="right1 Lf"><input type="text" id="id_number"></div>
                    <div class="ts Lf" style="margin-left: 5px;">身份证号格式不正确</div>
                </li>
                <li>
                    <div class="left1 Lf"><i class="red">*</i>身份证上传:</div>
                    <div class="right1 Lf">
                        <div class="uploade Lf">
                            <i style=""></i>
                            <img src="../img/list_logo.png" alt="" id="id_card_preview1">
                            <input type="file" id="id_card_pic1" onchange="xmTanUploadImg1(this);">
                            <input type="hidden" name="" value="" id="zhengjian_hidden1">
                        </div>
                        <div class="uploade Lf">
                            <i style=""></i>
                            <img src="../img/list_logo.png" alt="" id="id_card_preview2">
                            <input type="file" id="id_card_pic2" onchange="xmTanUploadImg2(this);">
                            <input type="hidden" name="" value="" id="zhengjian_hidden2">
                        </div>
                    </div>
                    <div  class="ts Lf" style="margin-left: 5px;">身份证上传不能为空</div>
                </li>
            </ul>
        </div>
        <!--<div class="right3 Lf weiRenZheng shenhezhong" style="margin-top: 10px;">-->
            <!--<div style="font-size: 12px;width: 128px;height: 73px;margin-left: 55px;">所有赎回中、支付中、 融资中、提票中和托收中 的总金额每笔交易资金， 都将在银行全称记录。</div>-->
            <!--<div style="margin-left: 32px;margin-top: 14px;font-size: 14px;"><img style="width: 13px;height: 13px;margin-top: 3px;" src="../img/wenhao.png" alt=""><a href="">为什么要进行出金账户绑定</a></div>-->
        <!--</div>-->

    </div>

    <div class="bottom1">
        <div class="right2 Lf" style="width: 750px;">
            <ul class="ul">
                <li class="pay_pass weiRenZheng">
                    <div class="left1 Lf"><i class="red">*</i>支付密码:</div>
                    <div class="right1 Lf"><input type="password" id="pay_pass"></div>
                    <div class="ts Lf" style="margin-left: 5px;">请输入6位的支付密码</div>
                </li>
                <li class="pay_pass weiRenZheng">
                    <div class="left1 Lf"><i class="red">*</i>确认密码:</div>
                    <div class="right1 Lf"><input type="password" id="ok_pass"></div>
                    <div class="ts Lf" style="margin-left: 5px;">确认密码和密码不一致</div>
                </li>
                <li class="pay_pass" style="width: 100%;">
                    <div class="left1 Lf"><span class="fr yincang">手机号:</span><span class="fr bb xianshi">验证手机号:</span><i class="red fr">*</i></div>
                    <div class="right1 Lf rz"><input type="text" id="yanzheng_phone" class="Lf"><a href="##" class="weiRenZheng" id="huoqu_code" style="color:#5590f6 ;margin-left: 15px; line-height: 38px;">获取验证码</a><span class="bb Lf yincang update_phone_btn">修改手机号</span></div>
                    <div class="ts bukeyong Lf"   style="margin-left: 5px;line-height: 38px;">手机号格式不正确</div>
                </li>
                <li class="pay_pass weiRenZheng">
                    <div class="left1 Lf"><i class="red">*</i>验证码:</div>
                    <div class="right1 Lf"><input type="text" id="code"></div>
                    <div class="ts Lf" style="margin-left: 5px;">验证码不能为空</div>
                </li>
                <li class="update_yincang">
                    <div class="left1 Lf"><i class="red">*</i>新手机号:</div>
                    <div class="right1 Lf"><input type="text" id='new_phone'><a href="##" id="huoqu_code1" style="color:#5590f6 ;margin-left: 15px;"  >获取验证码</a></div>
                    <div class="ts bukeyong2 yanzheng Lf" style="margin-left: 5px;">手机号码格式不正确</div>
                </li>
                <li class="pay_pass update_yincang">
                    <div class="left1 Lf"><i class="red">*</i>验证码:</div>
                    <div class="right1 Lf"><input type="text" id="new_code"></div>
                    <div class="ts yanzheng Lf" style="margin-left: 5px;">验证码不能为空</div>
                </li>
                <li class="update_yincang pay_pass">
                    <div class="left1 Lf"><i class="red">*</i>输入支付密码:</div>
                    <div class="right1 Lf"><input type="text" id="pay_pass2"></div>
                    <div class="ts yanzheng Lf" style="margin-left: 5px;">支付密码输入有误</div>
                </li>
            </ul>

            <div class="btn weiRenZheng next_btn">提交</div>
            <!--<div class="btn yiRenZheng update_btn">修改信息</div>-->
            
            <div class="yincang bb">
                <span class="submit_btn">提交</span>
                <span class="cancel_btn">取消</span>
            </div>
            <div class="" style="margin-left: 166px;margin-top: 26px;">
                <img src="../img/qq.png" alt="" style="float: none; vertical-align: bottom;">
                <a href="##" style="color: #5590f6;">客服QQ</a>
                <span>(工作日10 : 00 - 19 : 00)</span>
            </div>
            <div style="margin-left: 166px;margin-top: 5px;">认证过程中如有疑问，可致电 <a href="##" style="color: #5590f6;">400-1234567</a></div>
        </div>
    </div>
</div>


<script src="../js/jquery-3.2.1.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/common.js" type="text/javascript" charset="utf-8"></script>

<script src="../laydate/laydate.js"></script> <!-- 改成你的路径 -->
<script type="text/javascript">
    //Iframe 的高度
    $(function () {
        window.parent.$("#Iframe").css("height","990");
    })
        var img_url1 = null;
        var img_url2 = null;

        /*var companyId1 = window.localStorage.getItem('companyId');
        console.log(companyId1);*/
        var yanzheng_phone = '';

        var new_phone = '';

//不同浏览器下的路径不同
function getObjectURL(file) {
    var url = null;
    if (window.createObjectURL != undefined) { // basic

        url = window.createObjectURL(file);

    } else if (window.URL != undefined) { // mozilla(firefox)

        url = window.URL.createObjectURL(file);

    } else if (window.webkitURL != undefined) { // webkit or chrome

        url = window.webkitURL.createObjectURL(file);
    }

    return url;
}

//选择图片，马上预览
function xmTanUploadImg1(obj) {
    var file = obj.files[0];

    //添加图片路径到img src中进行预览
    $("#id_card_preview1").attr('src', getObjectURL(file));

    var formdata=new FormData();

    var c = $('#id_card_preview1')[0];
    var path = $(c).attr('src');

    formdata.append('file', file);
    
    formdata.append('path', path);


    $.ajax({
        url: 'http://manage.vanda360.com/ht/uplodImg/uploadImgByEditor.htm',
        type: 'post',
        processData: false,  // 告诉jQuery不要去处理发送的数据
        contentType: false,   // 告诉jQuery不要去设置Content-Type请求头
        data: formdata,
        cache: false,
        dataType: 'json',
        success: function (data) {
            console.log(data);

            img_url1 = data.url;
        },
        error: function (err) {
            console.log(err);
        }
    });

}

function xmTanUploadImg2(obj) {

    var file = obj.files[0];

    //添加图片路径到img src中进行预览
    $("#id_card_preview2").attr('src', getObjectURL(file));

    var formdata=new FormData();

    var c = $('#id_card_preview2')[0];
    var path = $(c).attr('src');

    formdata.append('file', file);
    
    formdata.append('path', path);


    $.ajax({
        url: 'http://manage.vanda360.com/ht/uplodImg/uploadImgByEditor.htm',
        type: 'post',
        processData: false,  // 告诉jQuery不要去处理发送的数据
        contentType: false,   // 告诉jQuery不要去设置Content-Type请求头
        data: formdata,
        cache: false,
        dataType: 'json',
        success: function (data) {
            console.log(data);
            img_url2 = data.url;
        },
        error: function (err) {
            console.log(err);
        }
    });
}

    $(function () {

        
       // if (window.localStorage.getItem('add-flag') == 'true') {

            //v1.0
            $.ajax({
                url: pubIP + 'companyCertification/getCompanyWriteStateByUserToken',
                type: 'post',
                headers: {
                    Accept: "application/json; charset=utf-8",
                    token: token
                },
                data: {
                    token: token
                },
                cache: false,
                dataType: 'json',
                success: function (data) {
                    console.log(data);
                    if (data.data.type == 7) {  //等待审核
                        $('.weiRenZheng.shenhezhong').css('display', 'inline-block');
                        $('.yiRenZheng.mei').css('display', 'none');
                        $(".weiRenZheng").addClass('xiaoshi');
                        $(".yiRenZheng.update_btn").css('display', 'none');
                    } else if (data.data.type == 2) {  //正在审核
                        $('.weiRenZheng.shenhezhong').css('display', 'inline-block');
                        $('.yiRenZheng.mei').css('display', 'none');
                        $(".weiRenZheng").addClass('xiaoshi');
                        $(".yiRenZheng.update_btn").css('display', 'none');
                        
                    } else if (data.data.type == 3) {  //已认证
                        $('.weiRenZheng.shenhezhong').css('display', 'none');
                        $('.yiRenZheng.mei').css('display', 'inline-block');
                        $(".weiRenZheng").addClass('xiaoshi');
                        $(".yiRenZheng.update_btn").css('display', 'inline-block');
                        
                    } else if (data.data.type == 4) {  //已拒绝
                        $('.weiRenZheng.shenhezhong').css('display', 'inline-block');
                        $('.yiRenZheng.mei').css('display', 'none');
                        $(".weiRenZheng").addClass('xiaoshi');
                        $(".yiRenZheng.update_btn").css('display', 'inline-block');
                        
                    } else if (data.data.type == 5) {  //企业资料二次审核中
                        if (window.localStorage.getItem('add-flag') == 'true') {   //认证过
                            $('.weiRenZheng.shenhezhong').css('display', 'none');
                            $('.yiRenZheng.mei').css('display', 'inline-block');
                            $(".weiRenZheng").addClass('xiaoshi');
                            $(".yiRenZheng.update_btn").css('display', 'inline-block');
                        } else {
                            $('.weiRenZheng').css('display', 'inline-block');
                        }

                    } else if (data.data.type == 6) {  //出金账户资料二次审核
                        if (window.localStorage.getItem('add-flag') == 'true') {   //认证过
                            $('.weiRenZheng.shenhezhong').css('display', 'none');
                            $('.yiRenZheng.mei').css('display', 'inline-block');
                            $(".weiRenZheng").addClass('xiaoshi');
                            $(".yiRenZheng.update_btn").css('display', 'inline-block');
                        } else {
                            $('.weiRenZheng').css('display', 'inline-block');
                        }
                        
                    } else if (data.data.type == 1) {  //没有提交
                        $('.weiRenZheng').css('display', 'inline-block');
                        $(".update_btn").addClass('xiaoshi');
                        $('#yanzheng_phone').attr('disabled', false);
                    }
                    
                },
                error: function (err) {
                    console.log(err);
                }
            })

    
       
        $(document).on('click', '.yiRenZheng.btn', function () {

            $('.dianji_yincang').css('display', 'none;');
            if ($('.ul li.yincang')) {
                $('.ul li.yincang').removeClass('yincang').addClass('xianshi');
            }
            $('.bb').removeClass('yincang').addClass('xianshi');

            $('.rz').addClass('current');

            $('.bl').removeClass('xianshi').addClass('yincang');

            $(this).css('display', 'none');

            $('.update_yincang').css('display', 'block').css('visibility', 'hidden');

        });

       $(document).on('click', '.update_phone_btn', function () {
            $('.update_yincang').css('visibility', 'visible');
       });

        $(document).on('click', '.weiRenZheng.btn', function () {

            if ($('#caiwu_name').val() == '') {
                $('#caiwu_name').parent().next().css('display', 'block');
                return;
            }

            var id_number_reg = $('#id_number').val();
            
            // 身份证号码为15位或者18位，15位时全为数字，18位前17位为数字，最后一位是校验位，可能为数字或字符X 
            var reg = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/; 
            if(reg.test(id_number_reg) === false) { 
                $('#id_number').parent().next().css('display', 'block');
                return; 
            }

            if ($('#id_card_preview1').attr('src') == '../img/list_logo.png' && $('#id_card_preview2').attr('src') == '../img/list_logo.png') {
                $('#id_card_preview2').parent().next().css('display', 'block');
                return;
            }

            var pay_pass_reg = $("#pay_pass").val().trim();      
            if(pay_pass_reg.length != 6){      
                var reg=/^\w{6,20}$/;;      
                if(!reg.test(pay_pass_reg)){      
                    $("#pay_pass").parent().next().css('display', 'block');
                    return;
                }  
            } 

            var ok_pass_yanzheng = $("#ok_pass").val().trim(); 
            if (ok_pass_yanzheng != $("#pay_pass").val().trim()) {
                $("#ok_pass").parent().next().css('display', 'block');
                return;
            } 

            if (!(/^1(3|4|5|7|8)\d{9}$/.test($('#yanzheng_phone').val().trim()))) {
                $('#yanzheng_phone').parent().next().css('display', 'block');
                return;
            }

            if ($('#code').val().trim() == '') {
                $('#code').parent().next().css('display', 'block');
                return;
            }

            var caiwu_name = $('#caiwu_name').val();
            var id_number = $('#id_number').val();
            var pay_pass = $('#pay_pass').val();
            var ok_pass = $('#ok_pass').val();
            yanzheng_phone = $('#yanzheng_phone').val();

            if (img_url1 != null && img_url2 != null) {
                //v1.0
                $.ajax({
                    url: pubIP + 'companyCertification/addCompanyBaseInfo',
                    type: 'post',
                    headers: {
                        Accept: "application/json; charset=utf-8",
                        token: token
                    },
                    data: {
                        submit_type: 'E',
                        companyId: companyId,
                        financeName: caiwu_name,
                        financeIdNumber: id_number,
                        passwordOne: pay_pass,
                        passwordTwo: ok_pass,
                        financePhoneNumber: yanzheng_phone,
                        upload_file8: img_url1,
                        upload_file9: img_url2
                    },
                    cache: false,
                    dataType: 'json',
                    success: function (data) {
                        console.log(data);
                       /* code_num.val(data.data);*/
                       window.parent.add_tan();
                       $('.weiRenZheng').css('display', 'none');
                       // window.localStorage.removeItem('add-flag');
                       window.localStorage.setItem('add-flag', 'true');
                       
                    },
                    error: function (err) {
                        console.log(err);
                    }
                });
            } else {
                $('#id_card_preview2').parent().next().html('图片正在上传').css('display', 'block');
            }
            


        });



        //获取验证码
        $('#huoqu_code').on('click', function () {

            if (!(/^1(3|4|5|7|8)\d{9}$/.test($('#yanzheng_phone').val().trim()))) {
                $('#yanzheng_phone').parent().next().css('display', 'block');
                return;
            }
            
            var mobile = $('#yanzheng_phone').val();

            console.log(mobile);
            var code_num = $('#code');

            //v1.0
            $.ajax({
                url: pubIP + 'user/getMessageCode',
                type: 'post',
                headers: {
                    Accept: "application/json; charset=utf-8",
                    token: token
                },
                data: {
                    mobile: mobile
                },
                cache: false,
                dataType: 'json',
                success: function (data) {
                    console.log(data);
                  
                },
                error: function (err) {
                    console.log(err);
                }
            });

        });

        $('#huoqu_code1').on('click', function () {

            
            var mobile = $('#new_phone').val();

            console.log(mobile);
            var code_num = $('#new_code');
            //v1.0
            $.ajax({
                url: pubIP + 'user/getMessageCode',
                type: 'post',
                headers: {
                    Accept: "application/json; charset=utf-8",
                    token: token
                },
                data: {
                    mobile: mobile
                },
                cache: false,
                dataType: 'json',
                success: function (data) {
                    console.log(data);
                  
                },
                error: function (err) {
                    console.log(err);
                }
            });

        });

        $('#caiwu_name').on('blur', function () {
            if ($('#caiwu_name').val() == '') {
                $('#caiwu_name').parent().next().css('display', 'block');
                return;
            } else {
                $('#caiwu_name').parent().next().css('display', 'none');
            }
        });

        $('#id_number').on('blur', function () {
            var id_number_reg = $('#id_number').val();
            
            // 身份证号码为15位或者18位，15位时全为数字，18位前17位为数字，最后一位是校验位，可能为数字或字符X 
            var reg = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/; 
            if(reg.test(id_number_reg) === false) { 
                $('#id_number').parent().next().css('display', 'block');
                return; 
            } else {
                $('#id_number').parent().next().css('display', 'none');
            }

        });



        $('#id_card_pic1').on('blur', function () {
            if ($('#id_card_preview1').attr('src') == '../img/list_logo.png' && $('#id_card_preview2').attr('src') == '../img/list_logo.png') {
                $('#id_card_preview2').parent().next().css('display', 'block');
            } else {
                $('#id_card_preview2').parent().next().css('display', 'none');
            }
        });

        $('#id_card_pic2').on('blur', function () {
            if ($('#id_card_preview2').attr('src') == '../img/list_logo.png' && $('#id_card_preview1').attr('src') == '../img/list_logo.png') {
                $('#id_card_preview2').parent().next().css('display', 'block');
            } else {
                $('#id_card_preview2').parent().next().css('display', 'none');
            }
        });


        $('#pay_pass').on('blur', function () {
            var pay_pass_reg = $("#pay_pass").val().trim();      
            if(pay_pass_reg.length != 6){      
                var reg=/^\w{6,20}$/;     
                if(!reg.test(pay_pass_reg)){      
                    $("#pay_pass").parent().next().css('display', 'block');
                }  
            } else {
                $('#pay_pass').parent().next().css('display', 'none');
            }
        });

        $('#ok_pass').on('blur', function () {
            var ok_pass_yanzheng = $(this).val().trim(); 
            if (ok_pass_yanzheng != $("#pay_pass").val().trim()) {
                $(this).parent().next().css('display', 'block');
            } else {
                $(this).parent().next().css('display', 'none');
            }
        });

        $('#yanzheng_phone').on('blur', function () {
            if (!(/^1(3|4|5|7|8)\d{9}$/.test($('#yanzheng_phone').val().trim()))) {
                $('#yanzheng_phone').parent().next().css('display', 'block');
                return;
            } else {
                $('#yanzheng_phone').parent().next().css('display', 'none');

                
                yanzheng_phone = $('#yanzheng_phone').val();
            
                console.log(yanzheng_phone);

                sendAjax(yanzheng_phone, $(this));

            }

        });

        $('#new_phone').on('blur', function () {
            if (!(/^1(3|4|5|7|8)\d{9}$/.test($('#new_phone').val().trim()))) {
                $('#new_phone').parent().next().css('display', 'block');
                return;
            } else {
                $('#new_phone').parent().next().css('display', 'none');

                
                new_phone = $('#new_phone').val();
            
                console.log(new_phone);

                sendAjax(new_phone, $(this));

            }

        });



        function sendAjax(phone_num, _this) {

            //v1.0
            $.ajax({
                url: pubIP + 'companyCertification/getMobileHaveCompanyState',
                type: 'post',
                headers: {
                    Accept: "application/json; charset=utf-8",
                    token: token
                },
                data: {
                    mobile: phone_num
                },
                cache: false,
                dataType: 'json',
                success: function (data) {
                    
                    console.log($(phone_num).parent().next().css('display', 'block'));
                    if (data.code == 1) {
                        if (data.data == 'true') {
                            _this.parent().next().html('手机号码已加入该企业');
                            _this.parent().next().css('display', 'block');
                            return;
                        }
                    } else if (data.code == -1001 ) {
                        alert(data.msg);
                    }
                    
                   /* code_num.val(data.data);*/

                },
                error: function (err) {
                    console.log(err);
                }
            });
        }

        $('#code').on('blur', function () {
            if ($('#code').val().trim() == '') {
                $('#code').parent().next().css('display', 'block');
                return;
            } else {
                $('#code').parent().next().css('display', 'none');
            }
        });

        $('#new_code').on('blur', function () {
            if ($('#new_code').val().trim() == '') {
                $('#new_code').parent().next().css('display', 'block');
                return;
            } else {
                $('#new_code').parent().next().css('display', 'none');
            }
        });



        $('#pay_pass2').on('blur', function () {
            if ($('#pay_pass2').val().trim() == '') {
                $('#pay_pass2').parent().next().css('display', 'block');
                return;
            } else {
                $('#pay_pass2').parent().next().css('display', 'none');
            }

            var pay_pass2 = $(this).val();

            //v1.0
            $.ajax({
                url: pubIP + 'companyCertification/getCompanyFinanceStateByFinancePassword',
                type: 'post',
                headers: {
                    Accept: "application/json; charset=utf-8",
                    token: token
                },
                data: {
                    companyId: companyId,
                    financePassword: pay_pass2
                },
                cache: false,
                dataType: 'json',
                success: function (data) {
                    console.log(data);
                    if (data.data == 'false') {
                        $('#pay_pass2').parent().next().css('display', 'block');
                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });

        });


        if (window.localStorage.getItem('add-flag') == 'true') {

            $(".weiRenZheng").addClass('xiaoshi');

            $('.header ul li a').each(function (i, ele) {
                $(this)[0].href = './identification'+(i+1)+'.html';
            });

            //v1.0
            $.ajax({
                url: pubIP + 'companyCertification/getCompanyBaseInfoAndAccountByCompanyId',
                type: 'post',
                headers: {
                    Accept: "application/json; charset=utf-8",
                    token: token
                },
                data: {
                    companyId: companyId,
                    type: 'E'
                },
                cache: false,
                dataType: 'json',
                success: function (data) {
                    if (data.code == 1) {
                        console.log(data);
                        $('#caiwu_name').val(data.data.company.financeName);
                        $('#id_number').val(data.data.company.financeIdNumber);

                        $('#yanzheng_phone').val(data.data.company.financePhoneNumber);
                        $('#yanzheng_phone').attr('disabled', 'disabled');
                        
                        
                        $('#id_card_preview1').attr('src', data.data.picInfos[7].picUrl);
                        $('#id_card_preview1').attr('data-picId8', data.data.picInfos[7].ids);

                        $('#id_card_preview2').attr('src', data.data.picInfos[8].picUrl);
                        $('#id_card_preview2').attr('data-picId9', data.data.picInfos[8].ids);

                        $('#zhengjian_hidden1').val(data.data.picInfos[7].ids);
                        $('#zhengjian_hidden2').val(data.data.picInfos[8].ids);

                       
                        
                    } else {
                        alert(data.msg);
                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }


        $(document).on('click', '.submit_btn', function () {
            
            if ($('#caiwu_name').val() == '') {
                $('#caiwu_name').parent().next().css('display', 'block');
                return;
            }

            var id_number_reg = $('#id_number').val();
            
            // 身份证号码为15位或者18位，15位时全为数字，18位前17位为数字，最后一位是校验位，可能为数字或字符X 
            var reg = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/; 
            if(reg.test(id_number_reg) === false) { 
                $('#id_number').parent().next().css('display', 'block');
                return; 
            }

            if ($('#id_card_preview1').attr('src') == '../img/list_logo.png' && $('#id_card_preview2').attr('src') == '../img/list_logo.png') {
                $('#id_card_preview2').parent().next().css('display', 'block');
                return;
            }

            if (!(/^1(3|4|5|7|8)\d{9}$/.test($('#new_phone').val().trim()))) {

                $('#new_phone').parent().next().css('display', 'block');
                
            }


            if ($('#new_code').val().trim() == '') {
                $('#new_code').parent().next().css('display', 'block');
                
            }

            if ($('#pay_pass2').val().trim() == '') {
                $('#pay_pass2').parent().next().css('display', 'block');
            }

            var caiwu_name = $('#caiwu_name').val();
            var id_number = $('#id_number').val();
            new_phone = $('#new_phone').val();

            var picId8 = $('#id_card_preview1').attr('data-picid8');
            var picId9 = $('#id_card_preview2').attr('data-picid9');
            
            console.log(picId9);

            //v1.0
            $.ajax({
                url: pubIP + 'companyCertification/addCompanyBaseInfo',
                type: 'post',
                headers: {
                    Accept: "application/json; charset=utf-8",
                    token: token
                },
                data: {
                    submit_type: 'E',
                    companyId: companyId,
                    financeName: caiwu_name,
                    financeIdNumber: id_number,
                    financePhoneNumber: new_phone,
                    picId8: picId8,
                    picId9: picId9,
                    upload_file8: img_url1,
                    upload_file9: img_url2
                },
                cache: false,
                dataType: 'json',
                success: function (data) {
                    console.log(data);
                   
                    window.parent.update_runcaiwu();
                    window.location.reload();
                },
                error: function (err) {
                    console.log(err);
                }
            });

        });

    });
</script>
</body>
</html>
